# If changed, go to https://sequencediagram.org/ to regenerate diagram
title ABP chromium booting up flow

participant ChromeBrowserMainParts (UI thread)
participant AdblockPlatformEmbedder (UI thread)
participant AdblockPlatformEmbedder (ABP thread)
participant libadblockplus (ABP thread)
participant AdblockController (UI thread)
participant AdblockStateSynchronizer (UI thread)

ChromeBrowserMainParts (UI thread)-->AdblockPlatformEmbedder (UI thread): CreateFilterEngine()

AdblockPlatformEmbedder (UI thread)-> AdblockPlatformEmbedder (ABP thread):Create platform and V8 isolate

AdblockPlatformEmbedder (ABP thread)->libadblockplus (ABP thread):Create platform providing\ninterfaces and V8 isolate
libadblockplus (ABP thread)-->AdblockPlatformEmbedder (ABP thread):Returns platform
AdblockPlatformEmbedder (ABP thread)->libadblockplus (ABP thread):Create Filter Engine async
note over libadblockplus (ABP thread):Will start downloading subscriptions\n(or request preloaded subscriptions)

libadblockplus (ABP thread)-->AdblockPlatformEmbedder (ABP thread):Notifies Filter Engine ready

note over libadblockplus (ABP thread):Subscriptions are stored after download,\nthis will speed up subsequent runs.

note over AdblockPlatformEmbedder (ABP thread):All requests to the Filter Engine\nwill be queued until this point

AdblockPlatformEmbedder (ABP thread)-->AdblockPlatformEmbedder (UI thread):Notifies Filter Engine ready

AdblockPlatformEmbedder (UI thread)-> AdblockStateSynchronizer (UI thread): OnFilterEngineCreated()
note over AdblockStateSynchronizer (UI thread):Store some libadblockplus settings in Chromium preferences:\n- allowed connection type, \n- custom filters, \n- allowed domains, \n- acceptable ads
AdblockPlatformEmbedder (UI thread)-> AdblockController (UI thread): OnFilterEngineCreated()
note over AdblockController (UI thread):Store recommended subscriptions in Chromium preferences
