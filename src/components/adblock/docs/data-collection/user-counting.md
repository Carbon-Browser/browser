# User counting

Being able to count users with ad-blocking + Acceptable Ads enabled, and those only with ad-blocking enabled, is necessary for the following reasons:

1. Understanding how users are distributed over different Chromium and SDK versions helps us decide which SDK versions continue maintaining and which ones could be put into an "End of Life" status.
2. Understanding how users are distributed over different operating systems and platforms (mobile, desktop, gaming console, smart TV, set top box, etc) helps to focus the investments on automation and quality assurance resources on the most popular OS versions and platforms.
3. Understanding how users perceive Acceptable Ads, as reflected by the opt-out rate from it, helps to continue updating the Acceptable Ads standard, to make sure that the user experience is not negatively impacted by the ads displayed to them.
4. For partners choosing to monetize their Acceptable Ads users, user counting is used as a basis for calculating partner payouts.

A ping request is sent automatically by the SDK to eyeo's dedicated service at least twice per day, if the browser is in use (including in the background) and ad-blocking is enabled. These pings don't contain any personally identifiable information, in order to respect the user's privacy.


## Ping request payload

The table below outlines the parameters sent with the ping.

In order to track which clients are "active" while maintaining user privacy, the server combines the values of ping timestamps and a randomly-generated tag. Dates are truncated to further protect privacy.

| Parameter           | Type   | Optional | Description           |
|---------------------|--------|----------|-----------------------|
| nonce               | string |          | Number only used once, one of the algorithms that might be used to generate nonce is UUID4. This helps to anonymously distinguish between several ping requests with the same values for the rest of the parameters. |
| addon_name          | string |          | Identifier of the SDK integration. Example: 'eyeo-chromium-sdk' |
| addon_version       | string |          | Version corresponding to addon_name. Example: '2.0.0' |
| application         | string |          | Identifier of either hosting (partner's) application or product as sent by the client. Example: 'chrome' |
| application_version | string |          | Version corresponding to application. Example: '86.0.4240.183' |
| first_ping          | string | ✅       | Timestamp of the first ping sent by the client and acknowledged by the server (as measured by the server), extracted from the first 2xx response body. Example: 2022-02-28T19:50:00Z |
| last_ping           | string | ✅       | Timestamp of the last ping sent by the client and acknowledged by the server (as measured by the server), extracted from 2xx response body. Example: 2022-02-28T19:50:00Z |
| last_ping_tag       | string | ✅       | Number generated by the client using UUID4 when it receives a response with a last_ping. Empty in the first message. If a ping is retried, the same last_ping_tag number should be used; this helps to anonymously distinguish between several ping requests with the same value of last_ping. |
| previous_last_ping  | string | ✅       | Timestamp of the previous to last ping sent by the client and acknowledged by the server (as measured by the server), copied from the last request. Example: 2022-02-28T19:50:00Z |
| aa_active           | bool   |          | Whether the client opted into Acceptable Ads. |
| platform            | string |          | Client operating system. Example: 'android' |
| platform_version    | string |          | Respective version corresponding to the OS. Example: '10' |

### Ping timestamps and tag fields

All the `*_ping` fields are left unparsed by the client, and consumed as the server sends them. This avoids subtle parsing errors, for instance, if the conversion method is locale-dependent and the format is changed, no longer matching the schema.

Additionally, the `*_ping` fields and `last_ping_tag` are optional. The first message omits these fields, since there are no values to provide form a previous ping. They are sent once the client has received a ping response. In order to adhere to the schema, the fields must be completely absent, not providing empty values.
