# If changed, go to https://sequencediagram.org/ to regenerate diagram

title ABPChromium User Setting flow
participant UIFragment.java (UI Thread)

ref over AdblockController.java (UI Thread): Extension API and unit tests start from here.

UIFragment.java (UI Thread) -> AdblockController.java (UI Thread): User event trigger(ex: onPreferenceChange)

opt Ex: 1 through preference change directly

note over AdblockController.java (UI Thread): Set User Pref directly
AdblockController.java (UI Thread) ->> AdblockStateSynchronizer(UI Thread): onPrefChanged
end

opt Ex: 2 Jni through AdblockController
AdblockController.java (UI Thread) ->AdblockControllerImpl (UI Thread): ex: AddCustomSubscription(url) \n          (jni binding)
note over AdblockControllerImpl (UI Thread): Set User Pref
AdblockControllerImpl (UI Thread) ->> AdblockStateSynchronizer(UI Thread): onPrefChanged
end

note over AdblockStateSynchronizer(UI Thread):For both scenarios, AdblockStateSynchronizer will post\n tasks directly to abp thread
AdblockStateSynchronizer(UI Thread) ->> AdblockStateSynchronizer(ABP Thread): ex:SynchronizeSubscriptions
AdblockStateSynchronizer(ABP Thread) ->FilterEngine(ABP Thread): AddSubscription(url
end
